{
  "openapi": "3.0.0",
  "info": {
    "title": "@digipair/skill-keycloak",
    "summary": "Affichage de pages web s√©curis√©e",
    "description": "Cette comp√©tence englobe la connaissance et l'utilisation des technologies web n√©cessaires pour d√©velopper et maintenir des sites internet s√©curis√©s par keycloak.",
    "version": "0.1.0",
    "x-icon": "üîê"
  },
  "paths": {
    "/executeFactory": {
      "post": {
        "summary": "Dans la factory",
        "description": "Ex√©cution d'une liste de capacit√© dans la factory",
        "tags": ["web"],
        "metadata": [],
        "parameters": [
          {
            "name": "execute",
            "summary": "Ex√©cuter",
            "required": true,
            "description": "Liste de capacit√© √† ex√©cuter",
            "schema": {
              "type": "array",
              "items": {
                "$ref": "https://schemas.digipair.ai/pinsSettings"
              }
            }
          },
          {
            "name": "secured",
            "summary": "S√©curis√©",
            "required": false,
            "description": "S√©curise l'ex√©cution via un token Keycloak",
            "schema": {
              "type": "boolean"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Ex√©cution r√©ussie",
            "content": {
              "application/json": {
                "schema": {
                  "type": "string",
                  "description": "Cha√Æne JSON contenant le r√©sultat de l'ex√©cution depuis la factory"
                }
              }
            }
          },
          "401": {
            "description": "Non autoris√© - Token Keycloak manquant ou invalide quand secured=true"
          },
          "403": {
            "description": "Interdit - Acc√®s refus√© par Keycloak"
          },
          "500": {
            "description": "Erreur serveur - Erreur d'ex√©cution de la factory"
          }
        }
      }
    },
    "/login": {
      "post": {
        "summary": "Identification de l'utilisateur",
        "description": "Identification de l'utilisateur sur le site internet via le serveur Keycloak",
        "tags": ["web"],
        "metadata": [],
        "parameters": [],
        "responses": {
          "200": {
            "description": "Connexion initi√©e avec succ√®s",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "description": "R√©ponse de connexion depuis Keycloak"
                }
              }
            }
          },
          "400": {
            "description": "Requ√™te invalide - Param√®tres de connexion invalides"
          },
          "500": {
            "description": "Erreur serveur - Erreur d'authentification Keycloak"
          }
        }
      }
    },
    "/logout": {
      "post": {
        "summary": "D√©sidentification de l'utilisateur",
        "description": "D√©sidentification de l'utilisateur sur le site internet via le serveur Keycloak",
        "tags": ["web"],
        "metadata": [],
        "parameters": [],
        "responses": {
          "200": {
            "description": "D√©connexion r√©ussie",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "description": "Confirmation de d√©connexion depuis Keycloak"
                }
              }
            }
          },
          "400": {
            "description": "Requ√™te invalide - Requ√™te de d√©connexion invalide"
          },
          "500": {
            "description": "Erreur serveur - Erreur de d√©connexion Keycloak"
          }
        }
      }
    }
  },
  "components": {
    "schemas": {
      "SecuredInput": {
        "type": "object",
        "tags": ["boost"],
        "summary": "Entr√©es s√©curis√©es",
        "properties": {
          "prompt": {
            "type": "boolean"
          },
          "required": {
            "type": "boolean"
          },
          "selector": {
            "type": "string"
          },
          "url": {
            "type": "string"
          },
          "inputs": {
            "type": "array",
            "items": {
              "$ref": "https://schemas.digipair.ai/pinsSettings"
            }
          }
        },
        "required": []
      },
      "SecuredStep": {
        "type": "object",
        "tags": ["boost"],
        "summary": "Etape",
        "properties": {
          "name": {
            "summary": "Nom de l'√©tape",
            "type": "string"
          },
          "execute": {
            "summary": "Actions √† ex√©cuter",
            "type": "array",
            "items": {
              "$ref": "https://schemas.digipair.ai/pinsSettings"
            }
          }
        },
        "required": ["name", "execute"]
      },
      "ContextParameter": {
        "type": "object",
        "tags": ["service"],
        "summary": "Parametre de contexte",
        "properties": {
          "name": {
            "summary": "Param√®tre",
            "type": "string"
          },
          "summary": {
            "summary": "Nom",
            "type": "string"
          },
          "required": {
            "summary": "Requis",
            "type": "boolean"
          },
          "schema": {
            "summary": "Schema",
            "type": "object"
          },
          "description": {
            "summary": "Description",
            "type": "string"
          }
        },
        "required": ["name", "summary", "required", "schema"]
      }
    }
  },
  "x-scene-blocks": {
    "/page": {
      "summary": "Page internet s√©curis√©e",
      "description": "Affichage d'une page d'un site internet s√©curis√©e par Keycloak.",
      "tags": ["web", "service"],
      "metadata": [],
      "parameters": [
        {
          "name": "body",
          "summary": "Contenu",
          "required": true,
          "description": "Contenu de la page",
          "schema": {
            "type": "array",
            "items": {
              "$ref": "https://schemas.digipair.ai/pinsSettings"
            }
          }
        },
        {
          "name": "head",
          "summary": "En t√™te",
          "required": false,
          "description": "En t√™te de la page",
          "schema": {
            "type": "array",
            "items": {
              "$ref": "https://schemas.digipair.ai/pinsSettings"
            }
          }
        },
        {
          "name": "ssr",
          "summary": "Rendu cot√© serveur",
          "required": false,
          "description": "Rendu cot√© serveur",
          "schema": {
            "type": "boolean"
          }
        },
        {
          "name": "styleHtml",
          "summary": "Style CSS du HTML",
          "required": false,
          "description": "Style css de l'√©l√©ment HTML",
          "schema": {
            "type": "string"
          }
        },
        {
          "name": "styleBody",
          "summary": "Style CSS du BODY",
          "required": false,
          "description": "Style css de l'√©l√©ment BODY",
          "schema": {
            "type": "string"
          }
        },
        {
          "name": "url",
          "summary": "Adresse du Keycloak",
          "required": false,
          "description": "Adresse du serveur Keycloak",
          "schema": {
            "type": "string"
          }
        },
        {
          "name": "realm",
          "summary": "Realm",
          "required": false,
          "description": "Realm du serveur Keycloak",
          "schema": {
            "type": "string"
          }
        },
        {
          "name": "clientId",
          "summary": "Client ID",
          "required": false,
          "description": "Client ID du serveur Keycloak",
          "schema": {
            "type": "string"
          }
        },
        {
          "name": "factoryUrl",
          "summary": "Adresse de la factory",
          "required": false,
          "description": "Adresse de la factory Digipair",
          "schema": {
            "type": "string"
          }
        },
        {
          "name": "keycloakJsUrl",
          "summary": "URL du Keycloak JS",
          "required": false,
          "description": "URL du script Keycloak JS √† inclure dans la page (par d√©faut pris depuis le param√®tre 'url')",
          "schema": {
            "type": "string"
          }
        },
        {
          "name": "factoryInitialize",
          "summary": "Lors de l'initialisation cot√© factory",
          "required": false,
          "description": "Action d√©clench√©e lors de l'initialisation cot√© factory",
          "schema": {
            "type": "array",
            "items": {
              "$ref": "https://schemas.digipair.ai/pinsSettings"
            }
          }
        },
        {
          "name": "browserInitialize",
          "summary": "Lors de l'initialisation cot√© navigateur",
          "required": false,
          "description": "Action d√©clench√©e lors de l'initialisation cot√© navigateur",
          "schema": {
            "type": "array",
            "items": {
              "$ref": "https://schemas.digipair.ai/pinsSettings"
            }
          }
        },
        {
          "name": "browserLoad",
          "summary": "Lorsque la page est charg√©e",
          "required": false,
          "description": "Action d√©clench√©e lorsque la page est charg√©e cot√© navigateur",
          "schema": {
            "type": "array",
            "items": {
              "$ref": "https://schemas.digipair.ai/pinsSettings"
            }
          }
        },
        {
          "name": "unlogged",
          "summary": "Si l'utilisateur n'est pas identifi√©",
          "required": false,
          "description": "Action d√©clench√©e lorsque la page est charg√©e cot√© navigateur si l'utilisateur n'est pas identifi√©",
          "schema": {
            "type": "array",
            "items": {
              "$ref": "https://schemas.digipair.ai/pinsSettings"
            }
          }
        },
        {
          "name": "logged",
          "summary": "Si l'utilisateur est identifi√©",
          "required": false,
          "description": "Action d√©clench√©e lorsque la page est charg√©e cot√© navigateur si l'utilisateur est identifi√©",
          "schema": {
            "type": "array",
            "items": {
              "$ref": "https://schemas.digipair.ai/pinsSettings"
            }
          }
        },
        {
          "name": "confirmBeforeUnload",
          "summary": "Confirmation avant de quitter",
          "required": false,
          "description": "Message de confirmation avant de quitter la page",
          "schema": {
            "type": "string"
          }
        }
      ],
      "responses": {
        "200": {
          "description": "Page web s√©curis√©e rendue avec succ√®s",
          "content": {
            "text/html": {
              "schema": {
                "type": "string",
                "description": "Page HTML avec int√©gration et s√©curit√© Keycloak"
              }
            }
          }
        },
        "401": {
          "description": "Non autoris√© - Authentification Keycloak requise"
        },
        "403": {
          "description": "Interdit - Acc√®s refus√© par Keycloak"
        },
        "404": {
          "description": "Non trouv√© - Page ou ressource non trouv√©e"
        },
        "500": {
          "description": "Erreur serveur - Erreur de rendu de page"
        }
      }
    },
    "/service": {
      "summary": "Web service s√©curis√©",
      "description": "R√©ponse √† un appel http s√©curis√© par Keycloak.",
      "tags": ["service"],
      "metadata": [],
      "parameters": [
        {
          "name": "execute",
          "summary": "Ex√©cute",
          "required": true,
          "description": "Commandes √† ex√©cuter",
          "schema": {
            "type": "array",
            "items": {
              "$ref": "https://schemas.digipair.ai/pinsSettings"
            }
          }
        },
        {
          "name": "secured",
          "summary": "S√©curis√©",
          "required": false,
          "description": "Acc√®s autoris√© seulement si un token Keycloak est fourni",
          "schema": {
            "type": "string"
          }
        },
        {
          "name": "url",
          "summary": "Adresse du Keycloak",
          "required": false,
          "description": "Adresse du serveur Keycloak",
          "schema": {
            "type": "string"
          }
        },
        {
          "name": "realm",
          "summary": "Realm",
          "required": false,
          "description": "Realm du serveur Keycloak",
          "schema": {
            "type": "string"
          }
        }
      ],
      "responses": {
        "200": {
          "description": "Service ex√©cut√© avec succ√®s",
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "description": "R√©sultat de l'ex√©cution du service"
              }
            }
          }
        },
        "401": {
          "description": "Non autoris√© - Token Keycloak manquant ou invalide quand secured=true"
        },
        "403": {
          "description": "Interdit - Acc√®s refus√© par Keycloak"
        },
        "500": {
          "description": "Erreur serveur - Erreur d'ex√©cution du service"
        }
      }
    },
    "/boost": {
      "summary": "Boost s√©curis√©",
      "description": "Boost propos√© par le Digipair s√©curis√© par Keycloak",
      "tags": ["boost", "service"],
      "metadata": [
        {
          "name": "standalone",
          "summary": "Autonome",
          "required": true,
          "description": "Boost d√©clenchable depuis une chatbot full ou une discussion",
          "schema": {
            "type": "boolean"
          }
        },
        {
          "name": "selector",
          "summary": "S√©lecteur CSS du d√©clencheur",
          "required": false,
          "description": "S√©lecteur CSS du d√©clencheur",
          "schema": {
            "type": "string"
          }
        },
        {
          "name": "url",
          "summary": "Correspondance URL",
          "required": false,
          "description": "Correspondance URL du d√©clencheur",
          "schema": {
            "type": "string"
          }
        },
        {
          "name": "context",
          "summary": "Contexte",
          "required": true,
          "description": "Schema du contexte",
          "schema": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/ContextParameter"
            }
          }
        }
      ],
      "parameters": [
        {
          "name": "steps",
          "summary": "Execute les √©tapes suivantes",
          "required": true,
          "description": "Execute les √©tapes d√©finies suivantes",
          "schema": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/SecuredStep"
            }
          }
        },
        {
          "name": "secured",
          "summary": "S√©curis√©",
          "required": false,
          "description": "Acc√®s autoris√© seulement si un token Keycloak est fourni",
          "schema": {
            "type": "string"
          }
        },
        {
          "name": "url",
          "summary": "Adresse du Keycloak",
          "required": false,
          "description": "Adresse du serveur Keycloak",
          "schema": {
            "type": "string"
          }
        },
        {
          "name": "realm",
          "summary": "Realm",
          "required": false,
          "description": "Realm du serveur Keycloak",
          "schema": {
            "type": "string"
          }
        }
      ],
      "responses": {
        "200": {
          "description": "√âtape de boost ex√©cut√©e avec succ√®s",
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "description": "R√©sultat de l'ex√©cution du boost avec donn√©es d'√©tape"
              }
            }
          }
        },
        "400": {
          "description": "Requ√™te invalide - √âtape ou param√®tres de boost invalides"
        },
        "401": {
          "description": "Non autoris√© - Token Keycloak manquant ou invalide quand secured=true"
        },
        "403": {
          "description": "Interdit - Acc√®s refus√© par Keycloak"
        },
        "405": {
          "description": "M√©thode non autoris√©e - Seule la m√©thode POST est support√©e"
        },
        "500": {
          "description": "Erreur serveur - Erreur d'ex√©cution du boost"
        }
      }
    }
  }
}
