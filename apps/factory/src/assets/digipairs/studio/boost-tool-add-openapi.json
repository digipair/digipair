{
  "description": "Adding a digipair from an OpenAPI v3 file.",
  "summary": "Adding a digipair from an OpenAPI file.",
  "library": "@digipair/skill-chatbot",
  "element": "boost",
  "metadata": {
    "standalone": true
  },
  "properties": {
    "steps": [
      {
        "name": "Initialisation",
        "execute": [
          {
            "library": "@digipair/skill-basic",
            "element": "setVariable",
            "properties": {
              "name": "toolType",
              "value": "FEEL: if request.body.context.type != null then request.body.context.type else \"tool\""
            }
          },
          {
            "library": "digipair:studio",
            "element": "action-answer",
            "properties": {
              "assistant": "What is the summary of this new {{variables.toolType}} agent?",
              "boost": [
                {
                  "prompt": true,
                  "required": true,
                  "step": "Api"
                }
              ]
            }
          }
        ]
      },
      {
        "name": "Api",
        "execute": [
          {
            "library": "@digipair/skill-basic",
            "element": "setVariable",
            "properties": {
              "name": "infos",
              "execute": [
                {
                  "library": "@digipair/skill-dsp",
                  "element": "generate",
                  "properties": {
                    "signature": "\"Extract the information for creating the digipair from the user's comment\"\ncomment:string \"User's comment describing the digipair to create\" -> \n  name:string \"Very short name of the agent from the comment in french\", \n  description:string \"Short description of the agent from the comment in french\", \n  assistant:string \"Assistant's response to confirm that the digipair has been successfully added and recall to the user to update his API key from the agent configuration in french\"",
                    "input": {
                      "comment": "{{request.body.prompt}}"
                    }
                  }
                }
              ]
            }
          },
          {
            "library": "@digipair/skill-basic",
            "element": "setVariable",
            "properties": {
              "name": "toolType",
              "value": "FEEL: if request.body.context.type != null then request.body.context.type else \"tool\""
            }
          },
          {
            "library": "digipair:studio",
            "element": "action-answer",
            "properties": {
              "assistant": "What is the URL of the OpenAPI v3 JSON or YAML?",
              "boost": [
                {
                  "prompt": true,
                  "required": true,
                  "step": "Execution",
                  "inputs": [
                    {
                      "library": "@digipair/skill-web-inputs",
                      "element": "digipair-input-hidden",
                      "properties": {
                        "value": {
                          "digipair": "FEEL: variables.toolType + \"-\" + kebabCase(request.body.prompt)",
                          "name": "FEEL: variables.infos.name",
                          "description": "FEEL: variables.infos.description",
                          "assistant": "FEEL: variables.infos.assistant"
                        }
                      }
                    }
                  ]
                }
              ]
            }
          }
        ]
      },
      {
        "name": "Execution",
        "execute": [
          {
            "library": "@digipair/skill-basic",
            "element": "setVariable",
            "properties": {
              "name": "openapi",
              "execute": [
                {
                  "library": "@digipair/skill-http",
                  "element": "read",
                  "properties": {
                    "path": "FEEL: request.body.prompt"
                  }
                }
              ]
            },
            "conditions": {
              "if": "FEEL: ends with(request.body.prompt, \".yaml\") = false"
            }
          },
          {
            "library": "@digipair/skill-basic",
            "element": "setVariable",
            "properties": {
              "name": "openapi",
              "execute": [
                {
                  "library": "@digipair/skill-http",
                  "element": "read",
                  "properties": {
                    "type": "text",
                    "path": "FEEL: request.body.prompt"
                  }
                },
                {
                  "library": "@digipair/skill-yaml",
                  "element": "load",
                  "properties": {
                    "yaml": "FEEL: previous"
                  }
                }
              ]
            },
            "conditions": {
              "if": "FEEL: ends with(request.body.prompt, \".yaml\") = true"
            }
          },
          {
            "library": "@digipair/skill-basic",
            "element": "setVariable",
            "properties": {
              "name": "openapi",
              "value": "FEEL: context merge(variables.openapi, { paths: context merge((for pathEntry in get entries(variables.openapi.paths) return context put({}, pathEntry.key, context merge((for methodEntry in get entries(pathEntry.value) return context put({}, methodEntry.key, if methodEntry.value.operationId != null then methodEntry.value else context merge(methodEntry.value, { operationId: methodEntry.key + \"-\" + replace(pathEntry.key, \"/\", \"\") }))))))) })"
            }
          },
          {
            "library": "@digipair/skill-basic",
            "element": "setVariable",
            "properties": {
              "name": "schema",
              "execute": [
                {
                  "library": "digipair:studio",
                  "element": "action-openapi2schema",
                  "properties": {
                    "openapi": "FEEL: variables.openapi",
                    "digipair": "FEEL: request.body.inputs[1].value.digipair",
                    "name": "FEEL: request.body.inputs[1].value.name",
                    "description": "FEEL: request.body.inputs[1].value.description"
                  }
                }
              ]
            }
          },
          {
            "library": "@digipair/skill-editor",
            "element": "addDigipair",
            "properties": {
              "template": "openapi-apikey",
              "data": {
                "digipair": "FEEL: request.body.inputs[1].value.digipair",
                "name": "FEEL: request.body.inputs[1].value.name",
                "description": "FEEL: request.body.inputs[1].value.description",
                "openapi": "FEEL: variables.openapi",
                "schema": "FEEL: variables.schema",
                "api": "FEEL: request.body.prompt",
                "key": "API_KEY"
              },
              "digipair": "FEEL: request.body.inputs[1].value.digipair"
            }
          },
          {
            "library": "@digipair/skill-editor",
            "element": "reasonings",
            "properties": {
              "digipair": "FEEL: request.body.inputs[1].value.digipair"
            }
          },
          {
            "library": "@digipair/skill-git",
            "element": "commit"
          },
          {
            "library": "@digipair/skill-git",
            "element": "push"
          },
          {
            "library": "digipair:studio",
            "element": "action-answer",
            "properties": {
              "assistant": "FEEL: request.body.inputs[1].value.assistant",
              "command": [
                {
                  "library": "@digipair/skill-web-interact",
                  "element": "goTo",
                  "properties": {
                    "url": "/studio/tool-edit/{{request.body.inputs.[0].value.digipair}}"
                  }
                }
              ]
            }
          }
        ]
      }
    ]
  },
  "pins": []
}
